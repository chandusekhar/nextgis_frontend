{"version":3,"file":"index.js","sources":["src/NgwKit.ts"],"sourcesContent":["import { Ngw } from '@nextgis/api-connector';\n\nexport interface NgwConfig {\n  applicationUrl: string;\n  assetUrl: string;\n  amdUrl: string;\n  id: number;\n}\n\nexport class NgwKit {\n\n  url: string;\n  resourceId: number;\n  connector: Ngw;\n\n  constructor(options?) {\n    this.url = options.baseUrl;\n    this.resourceId = options.resourceId;\n    this.connector = new Ngw({ baseUrl: this.url });\n  }\n\n  getSettings() {\n    return new Promise((resolve) => {\n      this.connector.request('resource.item', (data) => {\n        const webmap = data.webmap;\n        if (webmap) {\n\n          this._updateItemsUrl(webmap.root_item)\n\n          resolve(data.webmap);\n        }\n      }, { id: this.resourceId });\n    });\n  }\n\n  private _updateItemsUrl(item) {\n    if (item) {\n      if (item.children) {\n        item.children.forEach((x) => this._updateItemsUrl(x));\n      } else if (item.item_type === 'layer' && item.layer_adapter === 'image') {\n        const url = fixUrlStr(this.url + '/api/component/render/image');\n        item.url = url;\n      }\n    }\n  }\n}\n\nexport function fixUrlStr(url: string) {\n  // remove double slash\n  return url.replace(/([^:]\\/)\\/+/g, '$1');\n}\n"],"names":["Ngw"],"mappings":";;;;;;;MAeE,gBAAY,OAAQ;UAClB,IAAI,CAAC,GAAG,GAAG,OAAO,CAAC,OAAO,CAAC;UAC3B,IAAI,CAAC,UAAU,GAAG,OAAO,CAAC,UAAU,CAAC;UACrC,IAAI,CAAC,SAAS,GAAG,IAAIA,gBAAG,CAAC,EAAE,OAAO,EAAE,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC;OACjD;MAED,4BAAW,GAAX;UAAA,iBAYC;UAXC,OAAO,IAAI,OAAO,CAAC,UAAC,OAAO;cACzB,KAAI,CAAC,SAAS,CAAC,OAAO,CAAC,eAAe,EAAE,UAAC,IAAI;kBAC3C,IAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;kBAC3B,IAAI,MAAM,EAAE;sBAEV,KAAI,CAAC,eAAe,CAAC,MAAM,CAAC,SAAS,CAAC,CAAA;sBAEtC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;mBACtB;eACF,EAAE,EAAE,EAAE,EAAE,KAAI,CAAC,UAAU,EAAE,CAAC,CAAC;WAC7B,CAAC,CAAC;OACJ;MAEO,gCAAe,GAAvB,UAAwB,IAAI;UAA5B,iBASC;UARC,IAAI,IAAI,EAAE;cACR,IAAI,IAAI,CAAC,QAAQ,EAAE;kBACjB,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAC,CAAC,IAAK,OAAA,KAAI,CAAC,eAAe,CAAC,CAAC,CAAC,GAAA,CAAC,CAAC;eACvD;mBAAM,IAAI,IAAI,CAAC,SAAS,KAAK,OAAO,IAAI,IAAI,CAAC,aAAa,KAAK,OAAO,EAAE;kBACvE,IAAM,GAAG,GAAG,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,6BAA6B,CAAC,CAAC;kBAChE,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;eAChB;WACF;OACF;MACH,aAAC;EAAD,CAAC,IAAA;WAEe,SAAS,CAAC,GAAW;;MAEnC,OAAO,GAAG,CAAC,OAAO,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;EAC3C,CAAC;;;;;;;;;;;;"}