{"version":3,"file":"index.js","sources":["../api-connector/index.js","src/NgwKit.ts"],"sourcesContent":["\r\n\r\n// region inline polyfills\r\nObject.assign || Object.defineProperty(Object, \"assign\", { enumerable: !1, configurable: !0, writable: !0, value: function (e, r) { \"use strict\"; if (null == e) throw new TypeError(\"Cannot convert first argument to object\"); for (var t = Object(e), n = 1; n < arguments.length; n++) { var o = arguments[n]; if (null != o) for (var a = Object.keys(Object(o)), c = 0, b = a.length; c < b; c++) { var i = a[c], l = Object.getOwnPropertyDescriptor(o, i); void 0 !== l && l.enumerable && (t[i] = o[i]) } } return t } });\r\n\r\n(function (global, factory) {\r\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\r\n    typeof define === 'function' && define.amd ? define(['exports'], factory) :\r\n      (factory((global.Ngw = {})));\r\n}(this, (function (exports) {\r\n  'use strict';\r\n\r\n\r\n  var loadJSON = function (url, callback, context, error) {\r\n    var xmlHttp = new XMLHttpRequest();\r\n    xmlHttp.onreadystatechange = function () {\r\n      if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {\r\n        if (xmlHttp.responseText) {\r\n          try {\r\n            callback(JSON.parse(xmlHttp.responseText));\r\n          } catch (er) {\r\n            error(er);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    xmlHttp.open('GET', url, true); // true for asynchronous\r\n    xmlHttp.send(null);\r\n  };\r\n\r\n  // https://github.com/Leaflet/Leaflet/blob/b507e21c510b53cd704fb8d3f89bb46ea925c8eb/src/core/Util.js#L165\r\n  var templateRe = /\\{ *([\\w_-]+) *\\}/g;\r\n\r\n  var template = function (str, data) {\r\n    return str.replace(templateRe, function (str, key) {\r\n      var value = data[key];\r\n\r\n      if (value === undefined) {\r\n        throw new Error('No value provided for variable ' + str);\r\n\r\n      } else if (typeof value === 'function') {\r\n        value = value(data);\r\n      }\r\n      return value;\r\n    });\r\n  }\r\n\r\n  var OPTIONS = {\r\n    route: '/api/component/pyramid/route'\r\n    // baseUrl: 'http://'\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {Object} [options]\r\n   */\r\n  var NgwConnector = function (options) {\r\n    this.options = Object.assign({}, OPTIONS, options || {});\r\n    this.route;\r\n    this._loadingQueue = {};\r\n    this._loadingStatus = {};\r\n};\r\n\r\nNgwConnector.prototype.connect = function (callback, context) {\r\n  var self = this;\r\n  if (this.route) {\r\n    callback.call(context || this, this.route)\r\n  } else {\r\n    this.makeQuery(this.options.route, function (route) {\r\n      self.route = route;\r\n      callback.call(this, route);\r\n    }, {}, context);\r\n  }\r\n}\r\n\r\nNgwConnector.prototype.request = function (name, callback, params, error, context) {\r\n  var self = this;\r\n  this.connect(function (apiItems) {\r\n    for (var a in apiItems) {\r\n      if (apiItems.hasOwnProperty(a)) {\r\n        if (a === name) {\r\n          var apiItem = apiItems[a].slice();\r\n          var url = apiItem.shift();\r\n          if (apiItem.length) {\r\n            params = params || {};\r\n            var replaceParams = {};\r\n            for (var fry = 0; fry < apiItem.length; fry++) {\r\n              var arg = apiItem[fry];\r\n              replaceParams[fry] = '{' + arg + '}';\r\n              if (params[arg] === undefined) {\r\n                throw new Error('`' + arg + '`' + ' url api argument is not specified')\r\n              }\r\n            }\r\n            url = template(url, replaceParams)\r\n          }\r\n          self.makeQuery(url, callback, params, this, error);\r\n        }\r\n      }\r\n    }\r\n  }, context || this);\r\n}\r\n\r\nNgwConnector.prototype.makeQuery = function (url, callback, params, context, error) {\r\n  var self = this;\r\n  context = context || this;\r\n\r\n  url = (this.options.baseUrl ? this.options.baseUrl : '') + url;\r\n  if (url) {\r\n    if (params) {\r\n      url = template(url, params);\r\n    }\r\n    // remove double slash\r\n    url = url.replace(/([^:]\\/)\\/+/g, '$1');\r\n    if (!this._loadingStatus[url]) {\r\n      this._loadingStatus[url] = true\r\n      this._getJson(url, function (data) {\r\n        callback.call(context, data);\r\n        self._loadingStatus[url] = false;\r\n        self._exequteLoadingQueue(url, data);\r\n      }, context, function (er) {\r\n        self._loadingStatus[url] = false;\r\n        self._exequteLoadingQueue(url, er, true);\r\n        if (error) {\r\n          error.call(context, er);\r\n        } else {\r\n          throw new Error(er);\r\n        }\r\n      });\r\n    } else {\r\n      this._loadingStatus[url] = false;\r\n      this._setLoadingQueue(url, callback, context, error);\r\n    }\r\n  }\r\n  else {\r\n    throw new Error('No `url` parameter set for option ' + name);\r\n  }\r\n\r\n}\r\n\r\nNgwConnector.prototype._setLoadingQueue = function (name, callback, context, error) {\r\n  this._loadingQueue[name] = this._loadingQueue[name] || {\r\n    name: name,\r\n    waiting: []\r\n  };\r\n  this._loadingQueue[name].waiting.push({\r\n    callback: callback,\r\n    error: error,\r\n    context: context,\r\n    timestamp: new Date()\r\n  })\r\n}\r\n\r\nNgwConnector.prototype._exequteLoadingQueue = function (name, data, isError) {\r\n  var queue = this._loadingQueue[name];\r\n  if (queue) {\r\n    for (var fry = 0; fry < queue.waiting.length; fry++) {\r\n      var wait = queue.waiting[fry];\r\n      if (isError) {\r\n        if (wait.error) {\r\n          wait.error.call(wait.context, data);\r\n        }\r\n      } else {\r\n        wait.callback.call(wait.context, data);\r\n      }\r\n    }\r\n    queue.waiting = [];\r\n  }\r\n}\r\n\r\nNgwConnector.prototype._getJson = function (url, callback, context, error) {\r\n  return loadJSON(url, callback, context, error);\r\n}\r\nif (typeof window !== 'undefined') {\r\n  window.Ngw = NgwConnector;\r\n}\r\nexports.Ngw = NgwConnector;\r\n\r\n})));\r\n","import Ngw from '@ngw-front/api-connector';\n\nexport interface NgwConfig {\n  applicationUrl: string;\n  assetUrl: string;\n  amdUrl: string;\n  id: number;\n}\n\nexport class NgwKit {\n\n  url: string;\n  resourceId: number;\n  connector: Ngw;\n\n  constructor(options?) {\n    this.url = options.baseUrl;\n    this.resourceId = options.resourceId;\n    this.connector = new Ngw({ baseUrl: this.url });\n  }\n\n  getSettings() {\n    return new Promise((resolve) => {\n      this.connector.request('resource.item', (data) => {\n        if (data && data.webmap) {\n          resolve(data.webmap);\n        }\n      }, { id: this.resourceId });\n    });\n  }\n}\n"],"names":["this","Ngw"],"mappings":"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"}