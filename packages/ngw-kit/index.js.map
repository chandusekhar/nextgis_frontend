{"version":3,"file":"index.js","sources":["src/NgwKit.ts"],"sourcesContent":["import { Ngw } from '@nextgis/api-connector';\r\n\r\nexport interface NgwConfig {\r\n  applicationUrl: string;\r\n  assetUrl: string;\r\n  amdUrl: string;\r\n  id: number;\r\n}\r\n\r\nexport class NgwKit {\r\n\r\n  url: string;\r\n  resourceId: number;\r\n  connector: Ngw;\r\n\r\n  constructor(options?) {\r\n    this.url = options.baseUrl;\r\n    this.resourceId = options.resourceId;\r\n    this.connector = new Ngw({ baseUrl: this.url });\r\n  }\r\n\r\n  getSettings() {\r\n    return new Promise((resolve) => {\r\n      this.connector.request('resource.item', (data) => {\r\n        const webmap = data.webmap;\r\n        if (webmap) {\r\n\r\n          this._updateItemsUrl(webmap.root_item)\r\n\r\n          resolve(data.webmap);\r\n        }\r\n      }, { id: this.resourceId });\r\n    });\r\n  }\r\n\r\n  private _updateItemsUrl(item) {\r\n    if (item) {\r\n      if (item.children) {\r\n        item.children.forEach((x) => this._updateItemsUrl(x));\r\n      } else if (item.item_type === 'layer' && item.layer_adapter === 'image') {\r\n        const url = fixUrlStr(this.url + '/api/component/render/image');\r\n        item.url = url;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function fixUrlStr(url: string) {\r\n  // remove double slash\r\n  return url.replace(/([^:]\\/)\\/+/g, '$1');\r\n}\r\n"],"names":["Ngw"],"mappings":";;;;;;;MAeE,gBAAY,OAAQ;UAClB,IAAI,CAAC,GAAG,GAAG,OAAO,CAAC,OAAO,CAAC;UAC3B,IAAI,CAAC,UAAU,GAAG,OAAO,CAAC,UAAU,CAAC;UACrC,IAAI,CAAC,SAAS,GAAG,IAAIA,gBAAG,CAAC,EAAE,OAAO,EAAE,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC;OACjD;MAED,4BAAW,GAAX;UAAA,iBAYC;UAXC,OAAO,IAAI,OAAO,CAAC,UAAC,OAAO;cACzB,KAAI,CAAC,SAAS,CAAC,OAAO,CAAC,eAAe,EAAE,UAAC,IAAI;kBAC3C,IAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;kBAC3B,IAAI,MAAM,EAAE;sBAEV,KAAI,CAAC,eAAe,CAAC,MAAM,CAAC,SAAS,CAAC,CAAA;sBAEtC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;mBACtB;eACF,EAAE,EAAE,EAAE,EAAE,KAAI,CAAC,UAAU,EAAE,CAAC,CAAC;WAC7B,CAAC,CAAC;OACJ;MAEO,gCAAe,GAAvB,UAAwB,IAAI;UAA5B,iBASC;UARC,IAAI,IAAI,EAAE;cACR,IAAI,IAAI,CAAC,QAAQ,EAAE;kBACjB,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAC,CAAC,IAAK,OAAA,KAAI,CAAC,eAAe,CAAC,CAAC,CAAC,GAAA,CAAC,CAAC;eACvD;mBAAM,IAAI,IAAI,CAAC,SAAS,KAAK,OAAO,IAAI,IAAI,CAAC,aAAa,KAAK,OAAO,EAAE;kBACvE,IAAM,GAAG,GAAG,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,6BAA6B,CAAC,CAAC;kBAChE,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;eAChB;WACF;OACF;MACH,aAAC;EAAD,CAAC,IAAA;WAEe,SAAS,CAAC,GAAW;;MAEnC,OAAO,GAAG,CAAC,OAAO,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;EAC3C,CAAC;;;;;;;;;;;;"}